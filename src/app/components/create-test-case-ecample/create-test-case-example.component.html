<div class="header">
  <div fxLayout="row" fxLayoutAlign="center-center">
    <span fxFlex="6">{{ testCase.id }}</span>
    <input type="text" fxFlex="96" [(ngModel)]="name">
  </div>
</div>
<div>
  <mat-sidenav-container class="sidenav-container" fxFlex>
    <mat-sidenav #sidenav mode="side" opened>
      <form>
        <mat-form-field>
          <mat-label>Вид тестирования</mat-label>
          <mat-select [(ngModel)]="typeOfTest" name="type">
            @for (type of typesOfTests; track type) {
              <mat-option [value]="type">{{ type }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Приоритет</mat-label>
          <mat-select [(ngModel)]="type" name="priority">
            @for (priority of typesOfPriority; track priority) {
              <mat-option [value]="priority">{{ priority }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Признак</mat-label>
          <mat-select [(ngModel)]="automationFlag" name="automationFlag">
            @for (auto of automationFlags; track auto) {
              <mat-option [value]="auto">{{ auto }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Время выполнения</mat-label>
          <input matInput type="time" placeholder="Время выполнения" [(ngModel)]="executionTime" name="time">
        </mat-form-field>
        <mat-form-field>
          <mat-label>Готовность</mat-label>
          <mat-select [(ngModel)]="status" name="status">
            @for (status of statuses; track status) {
              <mat-option [value]="status">{{ status }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </form>
    </mat-sidenav>

    <mat-sidenav-content>
      <div>
        <button mat-icon-button (click)="toggleSidenav()">
          <mat-icon>{{ sidenav.opened ? 'keyboard_arrow_left' : 'keyboard_arrow_right' }}</mat-icon>
        </button>
        <div class="toolbar">
          <button mat-mini-fab class="btn_bold" (click)="toggleStyle('bold')" [class.active]="currentStyles['bold']"><b>B</b>
          </button>
          <button mat-mini-fab (click)="toggleStyle('normal')"
                  [class.active]="!currentStyles['bold'] && !currentStyles['italic'] && !currentStyles['underline']">N
          </button>
          <button mat-mini-fab class="btn_italic" (click)="toggleStyle('italic')"
                  [class.active]="currentStyles['italic']"><i>I</i></button>
          <button mat-mini-fab class="btn_red" (click)="toggleStyle('color', 'red')"
                  [class.active]="currentStyles['color-red']">R
          </button>
          <button mat-mini-fab class="btn_green" (click)="toggleStyle('color', 'green')"
                  [class.active]="currentStyles['color-green']">G
          </button>
          <button mat-mini-fab class="btn_black" (click)="toggleStyle('color', 'black')"
                  [class.active]="currentStyles['color-black']">Bl
          </button>
          <button (click)="toggleStyle('insertUnorderedList')">• List</button>
          <button (click)="insertImage()">Image</button>
          <button (click)="toggleStyle('pre')">Code</button>
          <button mat-mini-fab class="btn_highlight" (click)="toggleCustomClass('highlight', 'active-highlight')"
                  [class.active-highlight]="currentClasses['highlight']">AС
          </button>
          <button mat-mini-fab class="btn_underline" (click)="toggleCustomClass('underline', 'active-underline')"
                  [class.active-underline]="currentClasses['underline']">U
          </button>

        </div>
      </div>

      <div class="step-container" fxLayout="column">
        <div class="steps">
          <div>
            <mat-checkbox [(ngModel)]="allSelectedPreConditions" [indeterminate]="indeterminatePreCondition"
                          (change)="selectAllPreconditions($event.checked)">
              Предусловия
            </mat-checkbox>
          </div>
          <div style="background-color: #7abb6c" #editorContainer>
            <div *ngFor="let preCondition of preConditions; let i = index" class="editor-item" fxLayout="row">
              <mat-checkbox [(ngModel)]="preCondition.selected" (change)="updateAllSelectedPreconditions()"
                            fxFlex="6">{{ preCondition.id }}
              </mat-checkbox>
              <div class="steps-container" fxFlex="94">
                <div class="editor" #actionEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorPreConditionContent(actionEditor, i, 'action')">
                </div>
                <div class="editor" #expectedResultEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorPreConditionContent(expectedResultEditor, i, 'expectedResult')">
                </div>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="end center">
              <button mat-icon-button (click)="addPreCondition()">
                <mat-icon>add</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteSelectedPreconditions()">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="steps">
          <div>
            <mat-checkbox [(ngModel)]="allSelectedSteps" [indeterminate]="indeterminateSteps"
                          (change)="selectAllSteps($event.checked)">
              Шаги
            </mat-checkbox>
          </div>
          <div style="background-color: #7abb6c">
            <div *ngFor="let step of steps; let i = index" class="editor-item" fxLayout="row">
              <mat-checkbox [(ngModel)]="step.selected" (change)="updateAllSelectedSteps()" fxFlex="6">{{ step.id }}
              </mat-checkbox>
              <div class="steps-container" fxFlex="94">
                <div class="editor" #actionEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorStepContent(actionEditor, i, 'action')">
                </div>
                <div class="editor" #expectedResultEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorStepContent(expectedResultEditor, i, 'expectedResult')">
                </div>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="end center">
              <button mat-icon-button (click)="addStep()">
                <mat-icon>add</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteSelectedSteps()">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="steps">
          <div>
            <mat-checkbox [(ngModel)]="allSelectedPostConditions" [indeterminate]="indeterminatePostCondition"
                          (change)="selectAllPostConditions($event.checked)">
              Постусловия
            </mat-checkbox>
          </div>
          <div style="background-color: #7abb6c">
            <div *ngFor="let postCondition of postConditions; let i = index" class="editor-item" fxLayout="row">
              <mat-checkbox [(ngModel)]="postCondition.selected" (change)="updateAllSelectedPostConditions()"
                            fxFlex="6">{{ postCondition.id }}
              </mat-checkbox>
              <div class="steps-container" fxFlex="94">
                <div class="editor" #actionEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorPostConditionContent(actionEditor, i, 'action')">
                </div>
                <div class="editor" #expectedResultEditor
                     contenteditable="true"
                     fxFlex="50"
                     (focus)="setActiveEditor($event)"
                     (input)="autoResize($event)"
                     (blur)="updateEditorPostConditionContent(expectedResultEditor, i, 'expectedResult')">
                </div>

              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="end center">
              <button mat-icon-button (click)="addPostCondition()">
                <mat-icon>add</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteSelectedPostConditions()">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
