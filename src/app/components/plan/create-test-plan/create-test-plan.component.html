<div>
  <div mat-dialog-content class="example">
    <mat-form-field fxFlex="100">
      <input matInput type="text"
             [(ngModel)]="testPlanName"
             class="test-plan-name"
             placeholder="введите название тест плана"
             id="testPlanName"
             required
             minlength="3"
             #testCaseNameInput="ngModel"
             (ngModelChange)="onChange()">
      <!-- Сообщения об ошибках -->
      <mat-error *ngIf="testCaseNameInput.errors?.['required'] && testCaseNameInput.touched">
        Название тест-плана обязательно для заполнения.
      </mat-error>
      <mat-error *ngIf="testCaseNameInput.errors?.['minlength'] && testCaseNameInput.touched">
        Название тест-плана должно быть не менее 3 символов.
      </mat-error>
    </mat-form-field>
  </div>
  <div class="dialog-content" style="height: calc(100vh - 160px);">
    <as-split unit="percent" direction="horizontal" gutterSize="10" class="left-column-container">
      <as-split-area [size]="40">
        <div class="column left">
          <app-create-test-plan-tree (testCasesFromTree)="getTestCasesFromTree($event)"></app-create-test-plan-tree>
        </div>
      </as-split-area>

      <as-split-area [size]="60" maxSize="99.999">
        <div class="column right">
          <!--          <h3>Test Cases:</h3>-->
          <div class="table-container">
            <div class="table-container">
              <div class="table-btn-container">
                <button mat-icon-button [matMenuTriggerFor]="columnsMenu" class="column-menu-btn">
                  <mat-icon>view_column</mat-icon>
                </button>
                <mat-menu #columnsMenu="matMenu">
                  <mat-checkbox *ngFor="let column of allColumns" [(ngModel)]="displayedColumnsSelection[column]"
                                (change)="updateDisplayedColumns()">
                    {{ column }}
                  </mat-checkbox>
                </mat-menu>
              </div>

              <div>
                <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)"
                       class="table">
                  <!-- Checkbox Column -->
                  <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                      <mat-checkbox
                        [checked]="isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()"
                        (change)="$event ? masterToggle() : null">
                      </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let element">
                      <mat-checkbox
                        (click)="$event.stopPropagation()"
                        (change)="onCheckboxChange(element, $event)"
                        [checked]="element.selected">
                      </mat-checkbox>
                    </td>
                  </ng-container>

                  <!-- Position Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>id</th>
                    <td mat-cell *matCellDef="let element">{{ element.id }}</td>
                  </ng-container>

                  <!-- Name Column -->
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>name</th>
                    <td mat-cell *matCellDef="let element">{{ element.name }}</td>
                  </ng-container>

                  <!-- Type Column -->
                  <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>type</th>
                    <td mat-cell *matCellDef="let element">{{ element.type }}</td>
                  </ng-container>

                  <!-- Header and Rows -->
                  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                      (click)="openTestCaseDialog(row.id)"></tr>
                </table>

                <div *ngIf="isLoading" class="progress-bar-container">
                  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </as-split-area>
    </as-split>
  </div>

</div>

<div mat-dialog-actions fxLayout="row" fxLayoutAlign="end center">
  <button mat-flat-button (click)="save()" class="save-btn">Сохранить</button>
  <button mat-button (click)="closeMatDialog()" class="close-btn">Отмена</button>
</div>
