<!--<mat-progress-bar mode="indeterminate"></mat-progress-bar>-->
<div class="dialog-container">
  <div mat-dialog-content class="dialog-content">

    <div class="header">
      <div fxLayout="row" fxLayoutAlign="center-center">
        <div *ngIf="!new" fxFlex="6">
          <span fxFlex="6">{{ this.testCaseId }}</span>
        </div>
        <div *ngIf="new" fxFlex="6">
          <span fxFlex="6"></span>
        </div>
        <input type="text" fxFlex="91" [(ngModel)]="name" disabled>
      </div>
    </div>
    <div>
      <mat-sidenav-container class="sidenav-container" fxFlex>
        <mat-sidenav #sidenav mode="side" opened>
          <form>
            <mat-form-field>
              <mat-label>Результат</mat-label>
              <mat-select [(ngModel)]="selectedResult" name="type">
                @for (type of result; track type) {
                  <mat-option [value]="type">{{ type }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-card appearance="outlined" class="card">
              <mat-card-header>
                <mat-card-title>Вид тестирования</mat-card-title>
              </mat-card-header>
              <mat-card-content>{{ data.testCaseType }}</mat-card-content>
            </mat-card>

            <mat-card appearance="outlined" class="card">
              <mat-card-header>
                <mat-card-title>Приоритет</mat-card-title>
              </mat-card-header>
              <mat-card-content>{{ data.priority }}</mat-card-content>
            </mat-card>

            <mat-card appearance="outlined" class="card">
              <mat-card-header>
                <mat-card-title>Признак автоматизации</mat-card-title>
              </mat-card-header>
              <mat-card-content>{{ data.automationFlag }}</mat-card-content>
            </mat-card>

            <mat-card appearance="outlined" class="card">
              <mat-card-header>
                <mat-card-title>Время на выполнение</mat-card-title>
              </mat-card-header>
              <mat-card-content>{{ data.executionTime }}</mat-card-content>
            </mat-card>

            <mat-card appearance="outlined" class="card">
              <mat-card-header>
                <mat-card-title>Готовность</mat-card-title>
              </mat-card-header>
              <mat-card-content>{{ data.status }}</mat-card-content>
            </mat-card>

          </form>
        </mat-sidenav>

        <mat-sidenav-content>
          <div fxLayout="row" class="toolbar-plus-btn">
            <div fxFlex="7">
              <button mat-icon-button (click)="toggleSidenav()">
                <mat-icon>{{ sidenav.opened ? 'keyboard_arrow_left' : 'keyboard_arrow_right' }}</mat-icon>
              </button>
            </div>
          </div>

          <div class="step-container" fxLayout="column">
            <div class="steps">
              <div>
                <mat-checkbox [(ngModel)]="allSelectedPreConditions" [indeterminate]="indeterminatePreCondition"
                              (change)="selectAllPreconditions($event.checked)">
                  Предусловия
                </mat-checkbox>
              </div>
              <div #editorPreConditionContainer>
                <div *ngFor="let preCondition of preConditions; let i = index"

                     class="editor-item"
                     fxLayout="row">
                  <mat-checkbox [(ngModel)]="preCondition.selected" (change)="updateAllSelectedPreconditions()"
                                fxFlex="6">
                  </mat-checkbox>
                  <span fxFlex="3">{{ preCondition.index }}</span>
                  <div fxFlex="91" class="steps-container" [ngClass]="{'border-top': i === 0}">

                    <div class="editor" #actionEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, expectedResultEditor)"
                         (paste)="autoResize($event, expectedResultEditor)"
                         (focusin)="autoResize($event, expectedResultEditor)"
                         (resize)="autoResize($event, expectedResultEditor)"
                         (mouseup)="autoResize($event, expectedResultEditor)"
                         (blur)="updateEditorPreConditionContent(actionEditor, i, 'action')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)"
                    >
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">
                    <div class="editor" #expectedResultEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, actionEditor)"
                         (paste)="autoResize($event, actionEditor)"
                         (focusin)="autoResize($event, actionEditor)"
                         (resize)="autoResize($event, actionEditor)"
                         (mouseup)="autoResize($event, actionEditor)"
                         (blur)="updateEditorPreConditionContent(expectedResultEditor, i, 'expectedResult')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)"
                    >
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">
                  </div>
                </div>
              </div>
            </div>

            <div class="steps">
              <div>
                <mat-checkbox [(ngModel)]="allSelectedSteps" [indeterminate]="indeterminateSteps"
                              (change)="selectAllSteps($event.checked)">
                  Шаги
                </mat-checkbox>
              </div>
              <div #editorStepContainer>
                <div *ngFor="let step of steps; let i = index" class="editor-item" fxLayout="row"
                     [ngClass]="{
       'top-radius': i === 0,
       'bottom-radius': i === steps.length - 1
     }"
     >
                  <mat-checkbox [(ngModel)]="step.selected" (change)="updateAllSelectedSteps()" fxFlex="6">
                  </mat-checkbox>
                  <span fxFlex="3">{{ step.index }}</span>
                  <div class="steps-container" fxFlex="91" [ngClass]="{'border-top': i === 0}">
                    <div class="editor" #actionEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, expectedResultEditor)"
                         (paste)="autoResize($event, expectedResultEditor)"
                         (blur)="updateEditorStepContent(actionEditor, i, 'action')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)">
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">
                    <div class="editor" #expectedResultEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, actionEditor)"
                         (paste)="autoResize($event, actionEditor)"
                         (blur)="updateEditorStepContent(expectedResultEditor, i, 'expectedResult')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)">
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">
                  </div>
                </div>
              </div>
            </div>

            <div class="steps">
              <div>
                <mat-checkbox [(ngModel)]="allSelectedPostConditions" [indeterminate]="indeterminatePostCondition"
                              (change)="selectAllPostConditions($event.checked)">
                  Постусловия
                </mat-checkbox>
              </div>
              <div #editorPostConditionContainer>
                <div *ngFor="let postCondition of postConditions; let i = index" class="editor-item" fxLayout="row">
                  <mat-checkbox [(ngModel)]="postCondition.selected" (change)="updateAllSelectedPostConditions()"
                                fxFlex="6">
                  </mat-checkbox>
                  <span fxFlex="3">{{ postCondition.index }}</span>
                  <div class="steps-container" fxFlex="91" [ngClass]="{'border-top': i === 0}">
                    <div class="editor" #actionEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, expectedResultEditor)"
                         (paste)="autoResize($event, expectedResultEditor)"
                         (blur)="updateEditorPostConditionContent(actionEditor, i, 'action')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)">
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">
                    <div class="editor" #expectedResultEditor
                         contenteditable="false"
                         fxFlex="50"
                         (focus)="setActiveEditor($event)"
                         (input)="autoResize($event, actionEditor)"
                         (paste)="autoResize($event, actionEditor)"
                         (blur)="updateEditorPostConditionContent(expectedResultEditor, i, 'expectedResult')"
                         (drop)="handleDrop($event)"
                         (dragover)="handleDragOver($event)">
                    </div>
                    <input type="file" #fileInput accept="image/*" style="display: none;"
                           (change)="onFileSelected($event)">

                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-sidenav-content>
      </mat-sidenav-container>
    </div>
  </div>
</div>
<div mat-dialog-actions>
  <button mat-flat-button (click)="save()" class="save-btn" style="padding: 1rem">Сохранить</button>
  <button mat-button (click)="closeMatDialog()" class="close-btn" style="margin: 0 1rem 0 1rem; padding: 1rem">
    Отмена
  </button>
</div>



